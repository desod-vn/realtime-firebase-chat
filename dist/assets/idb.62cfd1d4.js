function b(e){return Array.prototype.slice.call(e)}function m(e){return new Promise(function(t,r){e.onsuccess=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function y(e,t,r){var o,n=new Promise(function(i,a){o=e[t].apply(e,r),m(o).then(i,a)});return n.request=o,n}function g(e,t,r){var o=y(e,t,r);return o.then(function(n){if(!!n)return new f(n,o.request)})}function c(e,t,r){r.forEach(function(o){Object.defineProperty(e.prototype,o,{get:function(){return this[t][o]},set:function(n){this[t][o]=n}})})}function _(e,t,r,o){o.forEach(function(n){n in r.prototype&&(e.prototype[n]=function(){return y(this[t],n,arguments)})})}function h(e,t,r,o){o.forEach(function(n){n in r.prototype&&(e.prototype[n]=function(){return this[t][n].apply(this[t],arguments)})})}function x(e,t,r,o){o.forEach(function(n){n in r.prototype&&(e.prototype[n]=function(){return g(this[t],n,arguments)})})}function s(e){this._index=e}c(s,"_index",["name","keyPath","multiEntry","unique"]);_(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]);x(s,"_index",IDBIndex,["openCursor","openKeyCursor"]);function f(e,t){this._cursor=e,this._request=t}c(f,"_cursor",["direction","key","primaryKey","value"]);_(f,"_cursor",IDBCursor,["update","delete"]);["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(f.prototype[e]=function(){var t=this,r=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,r),m(t._request).then(function(o){if(!!o)return new f(o,t._request)})})})});function u(e){this._store=e}u.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))};u.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))};c(u,"_store",["name","keyPath","indexNames","autoIncrement"]);_(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]);x(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]);h(u,"_store",IDBObjectStore,["deleteIndex"]);function p(e){this._tx=e,this.complete=new Promise(function(t,r){e.oncomplete=function(){t()},e.onerror=function(){r(e.error)},e.onabort=function(){r(e.error)}})}p.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))};c(p,"_tx",["objectStoreNames","mode"]);h(p,"_tx",IDBTransaction,["abort"]);function l(e,t,r){this._db=e,this.oldVersion=t,this.transaction=new p(r)}l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))};c(l,"_db",["name","version","objectStoreNames"]);h(l,"_db",IDBDatabase,["deleteObjectStore","close"]);function d(e){this._db=e}d.prototype.transaction=function(){return new p(this._db.transaction.apply(this._db,arguments))};c(d,"_db",["name","version","objectStoreNames"]);h(d,"_db",IDBDatabase,["close"]);["openCursor","openKeyCursor"].forEach(function(e){[u,s].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var r=b(arguments),o=r[r.length-1],n=this._store||this._index,i=n[e].apply(n,r.slice(0,-1));i.onsuccess=function(){o(i.result)}})})});[s,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(t,r){var o=this,n=[];return new Promise(function(i){o.iterateCursor(t,function(a){if(!a){i(n);return}if(n.push(a.value),r!==void 0&&n.length==r){i(n);return}a.continue()})})})});function D(e,t,r){var o=y(indexedDB,"open",[e,t]),n=o.request;return n&&(n.onupgradeneeded=function(i){r&&r(new l(n.result,i.oldVersion,n.transaction))}),o.then(function(i){return new d(i)})}function v(e){return y(indexedDB,"deleteDatabase",[e])}export{v as d,D as o};
